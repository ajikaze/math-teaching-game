# マナと学ぶ数学 - 要件定義書

**プロジェクト名**: Math Teaching Game with AI Character "Mana"  
**バージョン**: 1.0  
**作成日**: 2025 年 8 月 6 日  
**最終更新**: 2025 年 8 月 6 日

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [システム構成](#2-システム構成)
3. [機能要件](#3-機能要件)
4. [非機能要件](#4-非機能要件)
5. [技術要件](#5-技術要件)
6. [ユーザーインターフェース要件](#6-ユーザーインターフェース要件)
7. [セキュリティ要件](#7-セキュリティ要件)
8. [開発・運用要件](#8-開発運用要件)
9. [制約事項](#9-制約事項)
10. [Phase 2 実装機能](#10-phase-2-実装機能)
11. [Phase 3 拡張機能要件](#11-phase-3-拡張機能要件)
12. [今後の拡張計画](#12-今後の拡張計画)

---

## 1. プロジェクト概要

### 1.1 プロジェクトの目的

AI キャラクター「マナ」との対話を通じて、中学生レベルの数学を楽しく学習できる Web アプリケーションを開発する。

### 1.2 背景

-   従来の数学学習は一方的で退屈になりがち
-   個別指導の需要は高いが、コストと可用性の問題
-   AI 技術を活用したパーソナライズド学習の可能性
-   ゲーミフィケーション要素による学習意欲の向上

### 1.3 ターゲットユーザー

-   **主要ターゲット**: 中学生（12-15 歳）
-   **副次ターゲット**: 数学の基礎を学び直したい高校生・大学生・社会人
-   **保護者**: 子供の学習進捗を確認したい親

### 1.4 期待される効果

-   数学への苦手意識の軽減
-   個人のペースに合わせた学習の実現
-   継続的な学習習慣の形成
-   基礎学力の向上

---

## 2. システム構成

### 2.1 全体アーキテクチャ

```
Frontend (React + TypeScript + Vite)
    ↕ HTTP/REST API
Backend (Node.js + Express + TypeScript)
    ↕ API
Google Gemini AI (質問生成・回答評価)
    ↕ SQL
Database (PostgreSQL + Prisma ORM)
```

### 2.2 主要コンポーネント

-   **フロントエンド**: ユーザーインターフェース
-   **バックエンド API**: ビジネスロジック・データ処理
-   **AI 統合層**: Gemini AI との連携
-   **データベース**: ユーザーデータ・学習履歴の永続化
-   **認証システム**: ユーザー管理・セッション管理

---

## 3. 機能要件

### 3.1 AI キャラクター機能（マナ）

#### 3.1.1 基本特性

-   **名前**: マナ
-   **設定**: 好奇心旺盛な中学生女子
-   **性格**: 素直、学習意欲が高い、時々困惑する
-   **口調**: 親しみやすい丁寧語、適度な絵文字使用

#### 3.1.2 AI 機能

-   **質問生成**:
    -   分野別（代数・幾何・関数・確率）の問題出題
    -   学習者のレベルに応じた難易度調整
    -   会話履歴を考慮した重複回避
-   **回答評価**:
    -   学習者の説明内容の理解・評価
    -   建設的なフィードバック提供
    -   理解度に応じた経験値付与

#### 3.1.3 成長システム

-   **レベルシステム**: 経験値による段階的成長
-   **理解度管理**: 分野別理解度の追跡（0-100%）
-   **感情状態**: curious, happy, confused, excited の 4 状態

### 3.2 学習機能

#### 3.2.1 学習分野

1. **代数**: 方程式・不等式・因数分解
2. **幾何**: 図形・角度・面積・体積
3. **関数**: グラフ・一次関数・二次関数
4. **確率**: 場合の数・順列・組合せ

#### 3.2.2 学習フロー

1. 分野選択
2. マナからの質問提示
3. ユーザーによる説明入力
4. マナによる評価・フィードバック
5. 経験値・理解度の更新
6. 次の質問への進行

#### 3.2.3 入力方式

-   **テキスト入力**: 基本的な説明入力
-   **音声入力**: Web Speech API 利用（オプション）

### 3.3 ユーザー管理機能

#### 3.3.1 アカウント機能（将来実装）

-   ユーザー登録・ログイン
-   プロフィール管理
-   学習データの永続化

#### 3.3.2 進捗管理

-   学習時間の記録
-   解答数の追跡
-   分野別達成度の可視化

### 3.4 統計・分析機能

#### 3.4.1 学習統計

-   総レベル・経験値
-   分野別理解度
-   学習セッション数
-   会話回数

#### 3.4.2 可視化

-   理解度プログレスバー
-   学習統計グラフ
-   成長履歴チャート

---

## 4. 非機能要件

### 4.1 性能要件

-   **応答時間**: API 応答は 3 秒以内
-   **AI 応答時間**: 質問生成・評価は 10 秒以内
-   **同時接続**: 最大 100 ユーザーの同時利用
-   **可用性**: 稼働率 99%以上

### 4.2 スケーラビリティ

-   マイクロサービス化対応可能な設計
-   水平スケーリング対応
-   CDN 活用による配信最適化

### 4.3 信頼性

-   フォールバック機能（AI 利用不可時）
-   エラーハンドリング・ログ記録
-   データバックアップ・復旧機能

### 4.4 使いやすさ

-   直感的なユーザーインターフェース
-   レスポンシブデザイン（PC・タブレット・スマートフォン対応）
-   アクセシビリティ（キーボードナビゲーション、適切なコントラスト）

---

## 5. 技術要件

### 5.1 フロントエンド技術スタック

-   **フレームワーク**: React 18+ with TypeScript
-   **ビルドツール**: Vite
-   **スタイリング**: Tailwind CSS
-   **アイコン**: Lucide React
-   **状態管理**: React Hooks (useState, useEffect)

### 5.2 バックエンド技術スタック

-   **ランタイム**: Node.js 18+
-   **フレームワーク**: Express.js with TypeScript
-   **ORM**: Prisma
-   **バリデーション**: Joi
-   **認証**: JWT (将来実装)

### 5.3 AI・外部サービス

-   **AI API**: Google Gemini AI (gemini-1.5-flash)
-   **音声認識**: Web Speech API
-   **デプロイ**: Vercel (フロントエンド・バックエンド)

### 5.4 データベース

-   **開発環境**: SQLite
-   **本番環境**: PostgreSQL
-   **ORM**: Prisma

### 5.5 開発・運用ツール

-   **バージョン管理**: Git + GitHub
-   **CI/CD**: Vercel 自動デプロイ
-   **監視**: ログベースの監視
-   **エラートラッキング**: サーバーログ

---

## 6. ユーザーインターフェース要件

### 6.1 デザイン原則

-   **親しみやすさ**: 温かみのある色合い、丸みを帯びたデザイン
-   **わかりやすさ**: 明確なアクション、適切な情報階層
-   **楽しさ**: アニメーション効果、キャラクター表現

### 6.2 カラーパレット

-   **メインカラー**: ブルー系（#3B82F6, #6366F1）
-   **アクセント**: パープル系（#8B5CF6, #A855F7）
-   **成功**: グリーン系（#10B981, #059669）
-   **警告**: イエロー・オレンジ系（#F59E0B, #EF4444）

### 6.3 レイアウト構成

-   **ヘッダー**: キャラクター状態・レベル表示
-   **メインエリア**: 学習分野選択・対話エリア
-   **入力エリア**: テキスト入力・音声入力
-   **統計エリア**: 学習進捗・理解度表示

### 6.4 レスポンシブ対応

-   **モバイルファースト**: 最小幅 320px 対応
-   **タブレット**: 768px 以上で最適化
-   **デスクトップ**: 1024px 以上で最適化

---

## 7. セキュリティ要件

### 7.1 データ保護

-   **暗号化**: HTTPS 通信の強制
-   **入力検証**: すべてのユーザー入力の検証
-   **SQL インジェクション対策**: Prisma ORM による対策

### 7.2 API セキュリティ

-   **レート制限**: 1 分間 100 リクエスト制限
-   **CORS 設定**: 適切なオリジン制限
-   **API キー管理**: 環境変数による秘匿情報管理

### 7.3 プライバシー

-   **個人情報**: 最小限の情報収集
-   **データ保持**: 適切な保持期間設定
-   **匿名化**: 統計データの匿名化

---

## 8. 開発・運用要件

### 8.1 開発環境

-   **OS**: Windows, macOS, Linux 対応
-   **Node.js**: バージョン 18 以上
-   **エディタ**: VS Code 推奨
-   **ブラウザ**: Chrome, Firefox, Safari, Edge 対応

### 8.2 テスト要件

-   **単体テスト**: Jest
-   **API テスト**: Postman/curl
-   **E2E テスト**: 手動テスト

### 8.3 デプロイ・運用

-   **デプロイ**: Vercel 自動デプロイ
-   **環境管理**: 開発・本番環境の分離
-   **監視**: ログベースのエラー監視
-   **バックアップ**: データベース定期バックアップ

---

## 9. 制約事項

### 9.1 技術制約

-   **AI API 制限**: Gemini API 利用制限（無料枠内）
-   **ブラウザ対応**: モダンブラウザのみ対応
-   **音声認識**: Webkit ベースブラウザのみ対応

### 9.2 予算制約

-   **無料枠利用**: 可能な限り無料サービスを活用
-   **スケーラビリティ**: 段階的な機能拡張

### 9.3 時間制約

-   **MVP 開発**: 基本機能の早期リリース
-   **段階的開発**: 優先度に基づく機能実装

---

## 10. Phase 2 実装機能

### 10.1 データベース設計（✅ 完了）

#### 10.1.1 データモデル
- **User**: ユーザー基本情報（認証情報含む）
- **CharacterState**: キャラクター状態・学習進捗
- **Conversation**: 会話履歴・学習記録

#### 10.1.2 技術スタック
- **ORM**: Prisma ORM
- **データベース**: SQLite（開発）/ PostgreSQL（本番）
- **認証**: JWT トークンベース認証
- **セキュリティ**: bcryptjs パスワードハッシュ化

### 10.2 認証システム（✅ 完了）

#### 10.2.1 機能仕様
- ユーザー登録・ログイン
- JWTトークン発行・検証
- セキュアなパスワード管理
- セッション管理

#### 10.2.2 APIエンドポイント
```
POST /api/auth/register - ユーザー登録
POST /api/auth/login    - ログイン
GET  /api/auth/profile  - プロフィール取得
```

### 10.3 データ永続化API（✅ 完了）

#### 10.3.1 キャラクター管理API
```
GET  /api/data/character            - キャラクター状態取得
PUT  /api/data/character            - キャラクター状態更新
POST /api/data/character/experience - 経験値追加
PUT  /api/data/character/mood       - 気分更新
```

#### 10.3.2 会話履歴API
```
GET  /api/data/conversations - 会話履歴取得
POST /api/data/conversations - メッセージ保存
GET  /api/data/stats         - 統計情報取得
```

---

## 11. Phase 3 拡張機能要件

### 11.1 AI機能強化要件（Phase 3A）

#### 11.1.1 適応学習システム
**要件ID**: REQ-3A-001  
**優先度**: 高  
**実装目標**: ユーザーの理解度に応じた個別最適化

**機能詳細**:
- 学習履歴分析による難易度自動調整
- 苦手分野の自動検出と重点学習
- 個別学習パス生成アルゴリズム
- リアルタイム理解度評価

**技術要件**:
- 機械学習モデルの実装（推薦システム）
- ユーザー行動データの分析基盤
- A/Bテスト機能

#### 11.1.2 感情分析・パーソナライゼーション
**要件ID**: REQ-3A-002  
**優先度**: 高  
**実装目標**: ユーザーの学習状態に応じたキャラクター反応

**機能詳細**:
- テキスト感情分析（困惑、理解、興味など）
- 学習モチベーション状態の推定
- キャラクター反応パターンの動的調整
- 励ましメッセージの自動生成

### 11.2 学習分析・可視化要件（Phase 3B）

#### 11.2.1 詳細学習統計
**要件ID**: REQ-3B-001  
**優先度**: 高  
**実装目標**: 学習効果の定量的測定

**機能詳細**:
- 学習時間の自動追跡
- 正答率・間違い傾向の分析
- 分野別習熟度の可視化
- 学習効率指標の算出

**UI要件**:
- インタラクティブグラフ表示
- 期間別比較機能
- エクスポート機能（PDF/CSV）

#### 11.2.2 学習レポート自動生成
**要件ID**: REQ-3B-002  
**優先度**: 中  
**実装目標**: 保護者・教師向け学習成果報告

**機能詳細**:
- 週次・月次レポート自動作成
- 成長曲線の可視化
- 目標設定・達成度追跡
- 学習推奨事項の自動生成

### 11.3 ゲーミフィケーション要件（Phase 3C）

#### 11.3.1 実績・バッジシステム
**要件ID**: REQ-3C-001  
**優先度**: 中  
**実装目標**: 学習継続モチベーションの向上

**機能詳細**:
- 学習マイルストーン達成バッジ
- 連続学習日数記録
- 分野別専門家称号
- 特別イベント限定トロフィー

#### 11.3.2 チャレンジ・競技システム
**要件ID**: REQ-3C-002  
**優先度**: 中  
**実装目標**: ソーシャル学習要素の導入

**機能詳細**:
- 期間限定特別問題チャレンジ
- フレンド機能・学習競争
- リーダーボード表示
- チーム学習機能

### 11.4 コンテンツ拡張要件（Phase 3D）

#### 11.4.1 動的問題生成
**要件ID**: REQ-3D-001  
**優先度**: 中  
**実装目標**: 無限の学習コンテンツ提供

**機能詳細**:
- AI による問題自動生成
- 難易度パラメータ制御
- ユーザー専用問題セット作成
- 問題品質の自動評価

#### 11.4.2 ビジュアル学習対応
**要件ID**: REQ-3D-002  
**優先度**: 中  
**実装目標**: 直感的理解の促進

**機能詳細**:
- インタラクティブ図形問題
- 数式可視化ツール
- アニメーション解説
- 3D数学オブジェクト表示

### 11.5 システム機能強化要件（Phase 3E）

#### 11.5.1 PWA対応・オフライン機能
**要件ID**: REQ-3E-001  
**優先度**: 低  
**実装目標**: アクセシビリティ向上

**機能詳細**:
- Service Worker 実装
- オフライン学習機能
- プッシュ通知対応
- アプリライクな UX

#### 11.5.2 データエクスポート・連携
**要件ID**: REQ-3E-002  
**優先度**: 低  
**実装目標**: 外部システム連携

**機能詳細**:
- 学習データ CSV/JSON エクスポート
- Google Calendar 連携
- Slack/Discord 通知連携
- 外部 LMS との連携 API

### 11.6 Phase 3 非機能要件

#### 11.6.1 パフォーマンス要件
- **レスポンス時間**: AI生成処理 < 3秒
- **同時ユーザー数**: 1000人同時接続対応
- **データ処理量**: 10万件/日の学習データ処理

#### 11.6.2 スケーラビリティ要件
- **水平スケーリング**: コンテナ化対応
- **データベース**: 読み取り専用レプリカ対応
- **CDN**: 静的リソース配信最適化

---

## 12. 今後の拡張計画

### 12.1 Phase 1: 基本機能（✅ 完了）

-   ✅ AI キャラクター「マナ」の実装
-   ✅ 基本的な対話機能
-   ✅ 4 分野の学習機能（代数・幾何・関数・確率）
-   ✅ レベル・経験値システム
-   ✅ フロントエンド・バックエンド統合

### 12.2 Phase 2: データ永続化（✅ 完了）

-   ✅ ユーザー登録・ログイン機能
-   ✅ JWT 認証システム
-   ✅ Prisma ORM データベース設計
-   ✅ キャラクター状態・会話履歴保存
-   ✅ 学習統計 API

### 12.3 Phase 3: 高度機能拡張（📋 計画中）

-   📋 AI機能強化（適応学習・感情分析）
-   📋 学習分析・可視化システム
-   📋 ゲーミフィケーション要素
-   📋 動的コンテンツ生成
-   📋 PWA・オフライン対応

### 12.4 Phase 4: 高度化・スケーリング

-   📋 マルチ言語対応（英語・中国語）
-   📋 高度学習分析 AI
-   📋 モバイルアプリ化（React Native）
-   📋 リアルタイム協調学習

### 12.5 Phase 5: 事業化・運用

-   📋 有料プラン導入
-   📋 教育機関向け機能
-   📋 API 外部提供
-   📋 コンテンツマーケット

---

## 📊 要件優先度マトリクス

| 機能カテゴリ        | 優先度 | 実装状況 | 備考                     |
| ------------------- | ------ | -------- | ------------------------ |
| AI キャラクター機能 | 🔴 高  | ✅ 完了  | 核心機能                 |
| 基本学習機能        | 🔴 高  | ✅ 完了  | 4 分野対応               |
| UI/UX               | 🔴 高  | ✅ 完了  | レスポンシブ対応         |
| データ永続化        | 🔴 高  | ✅ 完了  | Prisma ORM + JWT認証     |
| ユーザー管理        | 🔴 高  | ✅ 完了  | 登録・ログイン・認証     |
| 基本統計・分析      | 🟡 中  | ✅ 完了  | キャラクター・会話統計   |
| 適応学習システム    | 🔴 高  | 📋 計画  | Phase 3A (AI機能強化)    |
| 学習分析・可視化    | 🔴 高  | 📋 計画  | Phase 3B (レポート生成)  |
| ゲーミフィケーション| 🟡 中  | 📋 計画  | Phase 3C (バッジ・競技)  |
| 動的コンテンツ生成  | 🟡 中  | 📋 計画  | Phase 3D (問題自動生成)  |
| PWA・オフライン機能 | 🔵 低  | 📋 計画  | Phase 3E (UX改善)        |
| ソーシャル機能      | 🔵 低  | 📋 将来  | Phase 4 以降             |
| 多言語対応          | 🔵 低  | 📋 将来  | Phase 4 以降             |
| モバイルアプリ      | 🔵 低  | 📋 将来  | Phase 4 以降             |

---

## 📝 変更履歴

| バージョン | 日付       | 変更内容                           | 担当者     |
| ---------- | ---------- | ---------------------------------- | ---------- |
| 1.0        | 2025-08-06 | 初版作成                           | 開発チーム |
| 1.1        | 2025-08-06 | Phase 2完了・Phase 3詳細要件追加   | 開発チーム |

---

## 📞 連絡先・承認

**文書作成者**: 開発チーム  
**レビュー者**: -  
**承認者**: -  
**承認日**: -

---

_この要件定義書は開発プロセスとともに継続的に更新されます。_
